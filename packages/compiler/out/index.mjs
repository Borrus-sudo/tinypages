import{marked as T}from"marked";async function d(s,r){return await Promise.all([...s].map(e=>e.getReady?e.getReady():null)),{methodReturn(e,t){return s.forEach(n=>{t=n.transform(e,t,r)||t}),t},methodArguments(e,t){return s.forEach(n=>{n.tapArgs&&(t=n.tapArgs(e,[...t])||t)}),t}}}import*as S from"shiki";import A from"katex";import{createRequire as j}from"module";var O=j(import.meta.url);function w(s,r){return r.type==="katex-mhcem"&&O("katex/contrib/mhchem"),r.config.katex.displayMode=!r.inlineRender,A.renderToString(s,r.config.katex||{throwOnError:!1})}function h(){let s,r,e,t,n=[];return{name:"core:code",async getReady(){s=await S.getHighlighter(t.shiki||{theme:"nord"})},defineConfig(i){t=i},transform(i,o){if(e){if(e.startsWith("mermaid"))t.renderMermaid&&(n.push({code:r,lang:e}),o="<GRAPH></GRAPH>");else if(e.startsWith("katex"))t.renderKatex&&(o=w(r,{type:e,inlineRender:i==="codespan",config:t}));else{let c=[],a={lang:e};e.includes(" ")&&([e,...c]=e.split(" "),a={lang:e,...JSON.parse(c.join(" "))});try{o=s.codeToHtml(r,a)}catch{}}return r=e="",o}},tapArgs(i,o){i==="code"?(r=o[0],e=o[1]):i==="codespan"&&([e,...r]=o[0].split(" "),r=r.join(" "))},async postTransform(i){if(n.length>0){let o=(await import("headless-mermaid")).default,c=[];for(let g of n){let x=[],k={theme:"forest",sequence:{showSequenceNumbers:!0}};g.lang.includes(" ")&&([,...x]=g.lang.split(" "),k={...JSON.parse(x.join(" "))}),c.push(o.execute(g.code,k))}let a=await Promise.all(c),m=0;return i.replace(/\<GRAPH\>\<\/GRAPH\>/g,g=>a[m++])}return i}}}import{parse as v}from"node-html-parser";function y(){let s=!1,r=[],e;return{name:"core:css",defineConfig(t){e=t},transform(t,n){if(t==="text")return s=!0,n.replace(/\[(.*?)\]/g,(i,o)=>(r.push(...o.replace(/ +/g," ").split(" ")),""));if(s&&(s=!1,r.length>0)){let i=v(n);return r.forEach(o=>i.childNodes?.[0]?.classList.add(o)),r=[],i.toString()}return n},async postTransform(t){if(!e.renderUnoCSS)return t;let{createGenerator:n}=await import("@unocss/core"),o=await n(e.unocss||{}).generate(t,{minify:!!e.minify});return e.metaConstruct.styles=o.css,t}}}import{parse as W}from"node-html-parser";import E from"node-icons";import{paramCase as I}from"param-case";var p=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","label","legend","li","link","main","map","mark","math","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rb","rp","rt","rtc","ruby","s","samp","script","section","select","slot","small","source","span","strong","style","sub","summary","sup","svg","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr"];function R(s){return Object.keys(s).forEach(r=>{s[r]=`"${s[r]}"`}),s}function L(s,r){let e=[];return r.flat().forEach(t=>{t.enforce?t.enforce==="pre"?s.unshift(t):e.push(t):s.push(t)}),[...s,...e]}async function M(s,r,e){for(let t of r)t.postTransform&&(s=await t.postTransform(s,e));return s}function N(s,r){let e=Object.getPrototypeOf(s),t=Reflect.ownKeys(e),n={};return t.forEach(i=>{let{value:o}=Reflect.getOwnPropertyDescriptor(e,i);n[i]=function(...c){let a=r.methodArguments(i,c),m=o.apply(s,a);return r.methodReturn(i,m)}}),n.options=s.options,n}var b;function u(s,r){b||(b=E(r.config.icons));let e=r.config?.icons?.separator??":",t=!1,n=s,i={},o={};return r.attrs?(n=I(s).replace(/\-/g,e),t=typeof r.attrs.base64<"u",t?(delete r.attrs.base64,i=r.config.defaultBase64IconsStyles||{}):i=r.config.defaultIconsStyles||{},o={...r.attrs,...i}):(s.startsWith("base64"+e)?(n=s.split(e).slice(1).join(e),t=!0,i=r.config.defaultBase64IconsStyles||{}):i=r.config.defaultIconsStyles||{},o=i),b.getIconsSync(n,t?o:R({...o}),t)}import{marked as G}from"marked";function C(){let s;return{name:"core:html",defineConfig(r){s=r},transform(r,e,t){if(r==="html"){let n=W(e);if(console.log("PLUGIN CALLED"),n?.childNodes[0].rawTagName.toLowerCase()==="head"){for(let o of n.childNodes[0].childNodes)switch(o?.rawTagName?.toLowerCase()){case"base":t.head.base={...o.attrs};break;case"link":t.head.link.push({...o.attrs});break;case"meta":t.head.meta.push({...o.attrs});break;case"noscript":t.head.noscript.push({innerHTML:o.innerHTML});break;case"script":t.head.script.push(o.attrs.src?{...o.attrs}:{type:o.attrs.type,innerHTML:o.innerHTML});break;case"style":t.head.style.push({type:o.attrs.type,cssText:o.innerHTML});case"title":t.head.title=o.innerText,t.head.titleAttributes=o.attrs;break}return""}let i=(o,c)=>{for(let a of o.childNodes){if(a&&a.nodeType===3&&a._rawText.trim()){a._rawText=G.parse(a._rawText.trim(),s.marked);continue}else if(c)continue;if(a&&a.rawTagName){let m=a.rawTagName.toLowerCase();if(m==="svg"||a.classList.contains("katex-display")||a.classList.contains("katex"))continue;if(!p.includes(m)){console.log(m);let g=u(m,{attrs:a.attrs,config:s});console.log(g),g?a.replaceWith(g):i(a,!0);continue}i(a,!1)}}};return i(n,!1),n.toString()}}}}import q from"node-emoji";function P(){let s,r;return{name:"core:text",defineConfig(e){r=e,s=r.plugins.find(t=>t.name==="core:code")},transform(e,t){if(e==="text"||e==="html")return t.replace(/(::(.*?)::)|(`[\s\S]*`)|(:(.*?):)/g,n=>{if((n.includes("<")||n.includes(">"))&&!n.startsWith("`"))return n;if(n.startsWith("::"))n=u(n.slice(2,-2),{config:r})||n;else if(n.startsWith("```")){let[i,...o]=n.slice(3,-3).split(`
`);s.tapArgs("code",[o.join(`
`),i]),n=s.transform("code",n)||n}else n.startsWith("`")?(s.tapArgs("codespan",[n.slice(1,-1)]),n=s.transform("codespan",n)||n):n=q.get(n);return n})}}}import{parse as U}from"node-html-parser";function H(s){let r=U(s),e=[],t=n=>{for(let i of n.childNodes)if(i&&i.rawTagName){let o=i.rawTagName.toLowerCase();if(o==="svg"||i.classList.contains("katex-display")||i.classList.contains("katex"))continue;if(!p.includes(o)){let c=i.toString().trim();e.push({componentName:i.rawTagName,componentLiteral:c,props:i.attrs||{},children:i.innerHTML}),i.replaceWith(c);continue}t(i)}};return t(r),[r.toString(),e]}async function ke(s,r){let e=Object.assign({},r,{metaConstruct:{styles:"",components:[],headTags:r.headTags||[],head:{base:{},htmlAttributes:{},link:[],meta:[],noscript:[],script:[],style:[],title:"",titleAttributes:{}},grayMatter:""}});e.plugins=L([y(),h(),P(),C()],e.plugins||[]),e.plugins.forEach(a=>a.defineConfig?a.defineConfig(e):0);let t=new T.Renderer,n=await d(e.plugins,e.metaConstruct),i=N(t,n),o=s.match(/---[\s\S]*---/)?.[0]??"";o&&(e.metaConstruct.grayMatter=o.slice(4,-3)),s=o?s.split(o)[1]:s,T.setOptions({renderer:i,...e.marked||{}});let c=T.parse(s);return c=await M(c,e.plugins,e.metaConstruct),[c,e.metaConstruct.components]=H(c),[c,e.metaConstruct]}export{ke as default};
